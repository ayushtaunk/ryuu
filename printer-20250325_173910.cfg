#Configuration file for the Anycubic Kobra 2 neo. (Trigorilla 4.0.1 Board)


#please read every comment before changing and using this config to ensure you dont break anything.


#DISCLAIMER
#This Printer config was written and optimized by and with the help of the Klipper forum group.
#THIS IS EXPERIMENTAL and nobody will give you any warranty in case your printer blows up.
#version 1.3.2
#fixed bed probing and set homing speed to a more sustainable value. Also added input shaper values generated by adxl measurement.
#please excuse any spelling or grammatical errors in my comments as english is not my native.
#comments by xenyonmedia and mysterious cable (reddit only)


#Included files
[include fluidd.cfg]
[include timelapse.cfg]
[include macros.cfg]
[include sample-bigtreetech-ebb-canbus-v1.2.cfg]
[include eddycoil.cfg]
[include led_progress.cfg]
# [include KAMP_Settings.cfg]
# [include line_purge.cfg]
# [include Smart_Park.cfg]
[exclude_object]
#[include adxl.cfg] #uncomment this if you want to connect an adxl sensor and have this config file

[mcu]
serial: /dev/serial/by-id/usb-Klipper_rp2040_50445061307E241C-if00
# serial: /dev/ttyAMA0
baud: 250000
restart_method: command

[stepper_x]
step_pin: gpio11
dir_pin: !gpio10
enable_pin: !gpio12
microsteps: 16
rotation_distance: 40
# endstop_pin: ^gpio4
endstop_pin: tmc2209_stepper_x:virtual_endstop
homing_retract_dist: 0
position_endstop: 0
position_max: 210
homing_speed: 20

[tmc2209 stepper_x]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 0
run_current: 0.8
hold_current: 0.5
stealthchop_threshold: 999999
diag_pin: ^gpio4
driver_SGTHRS: 60

[stepper_y]
step_pin: gpio6
dir_pin: gpio5
enable_pin: !gpio7
microsteps: 16
rotation_distance: 40
# endstop_pin: ^gpio3
endstop_pin: tmc2209_stepper_y:virtual_endstop
homing_retract_dist: 0
position_min: -20
position_endstop: -20
position_max: 240
homing_speed: 20

[tmc2209 stepper_y]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 2
run_current: 0.8
hold_current: 0.5
stealthchop_threshold: 999999
diag_pin: ^gpio3
driver_SGTHRS: 50

[stepper_z]
step_pin: gpio19
dir_pin: gpio28
enable_pin: !gpio2
microsteps: 16
rotation_distance: 8
# endstop_pin: ^gpio25
# position_endstop: 0
# endstop_pin: tmc2209_stepper_z:virtual_endstop
endstop_pin: probe:z_virtual_endstop
position_min: -2
position_max: 250
homing_speed: 8

[tmc2209 stepper_z]
uart_pin: gpio9
tx_pin: gpio8
uart_address: 1
run_current: 0.580
hold_current: 0.500
stealthchop_threshold: 999999
# diag_pin: ^gpio25
# driver_SGTHRS: 84

# [safe_z_home]
# # Coordinates of center of the bed
# home_xy_position: 110, 110
# speed: 100
# z_hop: 5
# z_hop_speed: 15
# [extruder]
# step_pin: gpio14
# dir_pin: !gpio13
# enable_pin: !gpio15
# microsteps: 16
# rotation_distance: 33.500
# nozzle_diameter: 0.4
# filament_diameter: 1.75
# heater_pin: gpio23
# sensor_type: EPCOS 100K B57560G104F
# sensor_pin: gpio27
# control: pid
# pid_Kp: 22.2
# pid_Ki: 1.08
# pid_Kd: 114
# min_temp: 0
# max_temp: 300
# max_extrude_cross_section:2

# [tmc2209 extruder]
# uart_pin: gpio9
# tx_pin: gpio8
# uart_address: 3
# run_current: 0.650
# hold_current: 0.500
# stealthchop_threshold: 999999

[filament_switch_sensor runout_sensor]
switch_pin: ^gpio16
pause_on_runout: True

# [filament_motion_sensor smart_sensor]
# switch_pin: ^gpio16
# detection_length: 2.5

[heater_bed]
heater_pin: gpio21
sensor_type: EPCOS 100K B57560G104F
sensor_pin: gpio26
control: pid
pid_Kp: 54.027
pid_Ki: 0.770
pid_Kd: 948.182
min_temp: 0
max_temp: 130

[temperature_fan mainboard_fan]
pin: gpio17
max_speed: 0.7
min_speed: 0.1
min_temp: 0
max_temp: 70
target_temp: 30
sensor_type: temperature_mcu
control: watermark
max_delta: 3 # Temperature difference before fan kicks in/out
# [heater_fan hotend_fan]
# pin: gpio18
# heater: extruder
# heater_temp: 50.0

# [temperature_sensor SKR_Pico]
# sensor_type: temperature_mcu
# min_temp: 0
# max_temp: 100

# [temperature_sensor EBBCan]
# sensor_type: temperature_mcu
# mcu: EBBCan
# min_temp: 0
# max_temp: 100

[temperature_sensor raspberry_pi_3A+]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[heater_fan controller_fan]
pin: gpio20
heater: heater_bed
heater_temp: 45.0

[input_shaper]
#shaper_freq_X: 46.0
shaper_freq_y: 34.0
shaper_type_y: mzv

[printer]
kinematics: cartesian
max_velocity: 500
max_accel: 8000
max_z_velocity: 25
max_z_accel: 30

#[bltouch]
#sensor_pin: gpio22
#control_pin: gpio29

[neopixel board_rgb]
pin: gpio24
chain_count: 1
color_order: GRB
initial_RED: 0.02
initial_GREEN: 0.02
initial_BLUE: 0.02

[delayed_gcode Welcome_0]
initial_duration: 0
gcode:
  SET_LED LED=ryuu RED=0.0 GREEN=0.0 BLUE=0.0

[delayed_gcode Welcome_1]
initial_duration: 1
gcode:
  SET_LED LED=ryuu RED=0 GREEN=1 BLUE=0 WHITE=0 INDEX=1 TRANSMIT=1

[delayed_gcode Welcome_2]
initial_duration: 2
gcode:
  SET_LED LED=ryuu RED=0 GREEN=1 BLUE=0 WHITE=1 INDEX=1 TRANSMIT=1
  SET_LED LED=ryuu RED=0 GREEN=1 BLUE=0 WHITE=0 INDEX=2 TRANSMIT=1

[delayed_gcode Welcome_3]
initial_duration: 3
gcode:
  SET_LED LED=ryuu RED=0 GREEN=0 BLUE=0 WHITE=1 INDEX=1 TRANSMIT=0
  SET_LED LED=ryuu RED=0 GREEN=0 BLUE=0 WHITE=1 INDEX=2 TRANSMIT=0
  SET_LED LED=ryuu RED=0 GREEN=1 BLUE=1 WHITE=0 INDEX=3 TRANSMIT=1

[delayed_gcode Welcome_4]
initial_duration: 10
gcode:
  SET_LED LED=ryuu RED=0 GREEN=0 BLUE=0 WHITE=0.2 INDEX=1 TRANSMIT=0
  SET_LED LED=ryuu RED=0 GREEN=0 BLUE=0 WHITE=0.2 INDEX=2 TRANSMIT=0
  SET_LED LED=ryuu RED=0 GREEN=0 BLUE=0 WHITE=0.03 INDEX=3 TRANSMIT=1

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3255547.201,0.090000:3255060.356,0.130000:3253612.109,
#*# 	0.170000:3252401.836,0.210000:3251241.340,0.250000:3250155.922,
#*# 	0.290000:3249082.478,0.330000:3248073.858,0.370000:3247066.597,
#*# 	0.410000:3246052.206,0.450000:3245031.320,0.490000:3244106.859,
#*# 	0.530000:3243109.859,0.570000:3242153.637,0.610000:3241176.687,
#*# 	0.650000:3240200.615,0.690000:3239070.440,0.730000:3237918.486,
#*# 	0.770000:3237022.131,0.810000:3236323.593,0.850000:3235684.628,
#*# 	0.890000:3235148.540,0.930000:3234473.371,0.970000:3233709.968,
#*# 	1.010000:3232841.416,1.050000:3232016.237,1.090000:3231199.784,
#*# 	1.130000:3230384.804,1.170000:3229604.348,1.210000:3228938.583,
#*# 	1.250000:3228275.953,1.290000:3227577.215,1.330000:3226960.408,
#*# 	1.370000:3226378.470,1.410000:3225801.988,1.450000:3225295.486,
#*# 	1.490000:3224752.522,1.530000:3224200.228,1.570000:3223670.188,
#*# 	1.610000:3223213.255,1.650000:3222717.115,1.690000:3222197.126,
#*# 	1.730000:3221650.377,1.770000:3220985.634,1.810000:3220351.944,
#*# 	1.850000:3219805.879,1.890000:3219322.330,1.930000:3218815.848,
#*# 	1.970000:3218288.627,2.010000:3217795.948,2.050000:3217277.873,
#*# 	2.090000:3216778.159,2.130000:3216307.677,2.170000:3215850.495,
#*# 	2.210000:3215385.146,2.250000:3215024.188,2.290000:3214607.942,
#*# 	2.330000:3214216.331,2.370000:3213855.155,2.410000:3213461.060,
#*# 	2.450000:3213037.783,2.490000:3212607.915,2.530000:3212246.548,
#*# 	2.570000:3211854.393,2.610000:3211471.165,2.650000:3211082.218,
#*# 	2.690000:3210648.360,2.730000:3210229.129,2.770000:3209916.053,
#*# 	2.810000:3209615.359,2.850000:3209314.793,2.890000:3208989.059,
#*# 	2.930000:3208665.617,2.970000:3208372.718,3.010000:3208094.917,
#*# 	3.050000:3207855.312,3.090000:3207562.503,3.130000:3207315.701,
#*# 	3.170000:3207024.947,3.210000:3206764.038,3.250000:3206493.048,
#*# 	3.290000:3206244.474,3.330000:3205946.986,3.370000:3205741.607,
#*# 	3.410000:3205489.196,3.450000:3205206.758,3.490000:3204975.575,
#*# 	3.530000:3204747.818,3.570000:3204492.537,3.610000:3204255.127,
#*# 	3.650000:3204034.326,3.690000:3203811.493,3.730000:3203603.908,
#*# 	3.770000:3203395.647,3.810000:3203159.479,3.850000:3202943.216,
#*# 	3.890000:3202753.892,3.930000:3202579.105,3.970000:3202383.249,
#*# 	4.010000:3202189.710,4.050000:3201975.163
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.101875, -0.075597, -0.062547, -0.033258, -0.020558, -0.000112, 0.005693, 0.007110, 0.021264, 0.031954
#*# 	  -0.069378, -0.031829, -0.020261, -0.000078, 0.016093, 0.039570, 0.046396, 0.067025, 0.067933, 0.079565
#*# 	  -0.054731, -0.020558, 0.014904, 0.030730, 0.046910, 0.061542, 0.100093, 0.093304, 0.111222, 0.131301
#*# 	  -0.021118, -0.012181, 0.009087, 0.023393, 0.034996, 0.052708, 0.063674, 0.087769, 0.087412, 0.106490
#*# 	  -0.018843, 0.004505, 0.017314, 0.033769, 0.056339, 0.059097, 0.068247, 0.085008, 0.096325, 0.112230
#*# 	  -0.000673, 0.005922, 0.017462, 0.028599, 0.044463, 0.052670, 0.075267, 0.090235, 0.101061, 0.115953
#*# 	  -0.079745, -0.063283, -0.043647, -0.028243, -0.006742, 0.007407, 0.013610, 0.034678, 0.052075, 0.073730
#*# 	  -0.088578, -0.078098, -0.077497, -0.061155, -0.029758, -0.018512, -0.005850, 0.007704, 0.023987, 0.048448
#*# 	  -0.137300, -0.124163, -0.107133, -0.103806, -0.077528, -0.071703, -0.055430, -0.034963, -0.009906, 0.009791
#*# 	  -0.244063, -0.240593, -0.235137, -0.205562, -0.188268, -0.159281, -0.140861, -0.115771, -0.095798, -0.057190
#*# x_count = 10
#*# y_count = 10
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 195.0
#*# min_y = 27.3
#*# max_y = 204.96
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 46.6
